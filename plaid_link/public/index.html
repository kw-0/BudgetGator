<!DOCTYPE html>
<html>
  <head>
    <title>Plaid Login</title>
    <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
  </head>
  <body>
    <h2>Plaid Login</h2>
    <button id="link-btn">Connect Bank</button>

    <script>
      async function createLinkToken() {
        const res = await fetch("/api/create_link_token", { method: "POST" });
        const data = await res.json();
        return data.link_token;
      }

      async function openPlaidLink() {
        const linkToken = await createLinkToken();
        const handler = Plaid.create({
          token: linkToken,
          onSuccess: async (public_token) => {
            console.log("Public token:", public_token);
            const res = await fetch("/api/exchange_public_token", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ public_token }),
            });
            const data = await res.json();
            console.log("Access token response:", data);
            alert("Access token created â€” check your server logs!");
          },
          onExit: (err, metadata) => {
            console.error("Plaid Link exited:", err, metadata);
          },
        });
        handler.open();
      }

      document.getElementById("link-btn").onclick = openPlaidLink;
    </script>
  </body>
</html>
